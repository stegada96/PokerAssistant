workflows:
  android-workflow:
    name: PokerAssistant APK
    max_build_duration: 60
    environment:
      flutter: stable
    scripts:
      - |
        set -e
        echo "== ROOT ==" && pwd && ls -la
        cd poker_assistant
        echo "== FLUTTER PROJECT ==" && pwd && ls -la

        echo "== FLUTTER VERSION ==" && flutter --version
        echo "== PUB GET ==" && flutter pub get

        # IMPORTANTISSIMO: per ora NON blocchiamo se formatta file
        echo "== FORMAT (NON-BLOCKING) ==" && dart format .

        echo "== ANALYZE ==" && flutter analyze
        echo "== TEST ==" && flutter test

        echo "== NO DOT-SHORTHAND =="
        if grep -R -nE ":\s*\." lib; then
          echo "ERRORE: trovata dot-shorthand"
          exit 1
        else
          echo "OK"
        fi

        echo "== BUILD APK ==" && flutter build apk --release
    artifacts:
      - poker_assistant/build/app/outputs/flutter-apk/app-release.apk
